#!/bin/bash
set -e

. _common
fs="ext3"
ptlfs="../src/partclone.extfs"
dd_count=$((normal_size/2))
echo -e "Ncurses test"
echo -e "====================\n"
echo -e "\ncreate raw file $raw\n"
_ptlbreak
[ -f $raw ] && rm $raw
echo -e "    dd if=/dev/zero of=$raw bs=$dd_bs count=$dd_count\n"
dd if=/dev/zero of=$raw bs=$dd_bs count=$dd_count

echo -e "\nclone $raw to $img\n"
[ -f $img ] && rm $img
<<<<<<< HEAD
echo "$ptlfs -d -c -s $raw -O $img -F -L $logfile"
=======
echo -e "    $ptlfs -d -N -s $raw -O $img -F -L $logfile\n"
>>>>>>> a9f7045... finish tests script
_ptlbreak
$ptlfs -d -c -N -s $raw -O $img -F -L $logfile -a 1 -k 17
_check_return_code

<<<<<<< HEAD

echo "create raw file $raw for restore"
_ptlbreak
[ -f $raw ] && rm $raw
echo "dd if=/dev/zero of=$raw bs=$dd_bs count=$dd_count"
dd if=/dev/zero of=$raw bs=$dd_bs count=$dd_count

echo "restore $img to $raw"
echo "$ptlrestore -s $img -O $raw -C -F -L $logfile"
_ptlbreak
$ptlrestore -N -s $img -O $raw -C -F -L $logfile
_check_return_code

echo "$fs test ok"
echo "clear tmp files $img $raw $logfile $md5"
=======
echo -e "\nncursesw test ok\n"
echo -e "\nclear tmp files $img $raw $logfile $md5\n"
>>>>>>> a9f7045... finish tests script
_ptlbreak
rm -f $img $raw $logfile $md5


